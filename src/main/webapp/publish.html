<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>登录/注册</title>

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom styles for this template -->
    <link href="./static/signin.css" rel="stylesheet">
</head>

<body>

<div class="container">

    <form class="form-signin">
        <h2 class="form-signin-heading">发布任务/技能</h2>

        <label for="publishSubject" class="sr-only">标题</label>
        <input type="plaintext" id="publishSubject" class="form-control" placeholder="标题" required="">

        <input type="radio" name="optionsRadios" id="optionsRadios1" value="1">任务
        <span></span>
        <input type="radio" name="optionsRadios" id="optionsRadios2" value="2">技能

        <label for="publishDetail" class="sr-only">正文</label>
        <textarea type="plaintext" id="publishDetail" class="form-control" placeholder="正文" required="" rows="15"
                  style="margin-top: 10px" autofocus=""></textarea>
    </form>

    <form class="form-signin">
        <h2 class="form-signin-heading">联系方式</h2>

        <label for="publishEmail" class="sr-only">邮箱</label>
        <input type="email" id="publishEmail" class="form-control" placeholder="邮箱" required="">

        <label for="publishMobile" class="sr-only">手机</label>
        <input type="plaintext" id="publishMobile" class="form-control" placeholder="手机" required="">

        <label for="publishWechat" class="sr-only">微信</label>
        <input type="plaintext" id="publishWechat" class="form-control" placeholder="微信" required="">

        <label for="publishQQ" class="sr-only">QQ</label>
        <input type="plaintext" id="publishQQ" class="form-control" placeholder="QQ" required="">

        <label for="publishVerifyCode" class="sr-only">验证码</label>
        <input type="plaintext" id="publishVerifyCode" class="form-control" placeholder="验证码" required="">
        <a onclick="changeVerifyCode()">更换验证码</a> <img src="./static/verifyCode.jpg" width="40"
                                                       height="20"
                                                       align="right" id="verifyCode">
        <!--<div class="checkbox">-->
        <!--<label>-->
        <!--<input type="checkbox" value="remember-me"> Remember me-->
        <!--</label>-->
        <!--</div>-->
        <button class="btn btn-lg btn-primary btn-block" type="button" style="margin-top: 10px"
                onclick="publishCheck()">
            提交
        </button>
    </form>

</div> <!-- /container -->

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>

<script>
    function publishCheck() {

        var publishType = $("input[name='optionsRadios']:checked").val();
        var publishSubject = $("#publishSubject").val();
        var publishDetail = $("#publishDetail").val();
        var publishEmail = $("#publishEmail").val();
        var publishMobile = $("#publishMobile").val();
        var publishWechat = $("#publishWechat").val();
        var publishQQ = $("#publishQQ").val();
        var publishVerifyCode = $("#publishVerifyCode").val();

        if (publishSubject === "" || publishDetail === "" || publishVerifyCode === "" || publishType == null) {
            alert("发布类型/标题/正文/验证码/不能为空！");
            return;
        }
        if (publishEmail === "" && publishMobile === "" && publishWechat === "" && publishQQ === "") {
            alert("邮箱/手机/微信/QQ至少填写一项！");
            return;
        }
        if (publishEmail !== "" && publishEmail.indexOf("@") <= 0) {
            alert("邮箱格式有误！");
            return;
        }

        $.post("addTopic.json",
                {
                    publishSubject: publishSubject,
                    publishDetail: publishDetail,
                    publishEmail: publishEmail,
                    publishMobile: publishMobile,
                    publishWechat: publishWechat,
                    publishQQ: publishQQ,
                    publishVerifyCode: publishVerifyCode,
                    publishType: publishType
                },
                function (data) {
                    var obj = $.parseJSON(data);
                    if (obj.respCode === "1000") {
                        window.location.href = "./platform.html";
                    }
                    else {
                        alert(obj.respMsg);
                    }
                }
        )
    }

    function changeVerifyCode() {
        $.ajax({
            type: "post",
            url: "changeVerifyCode.json",
            data: "",
            async: false,
            success: function (data) {
                var obj = $.parseJSON(data);
                if (obj.respCode === "1000") {
                    document.getElementById('verifyCode').src = './static/verifyCode.jpg?' + Math.random();
                }
                else {
                    alert(obj.respMsg);
                }
            }
        });
    }
</script>
</body>
</html>